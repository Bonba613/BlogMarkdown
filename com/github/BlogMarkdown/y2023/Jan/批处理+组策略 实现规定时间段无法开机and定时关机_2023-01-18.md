# 批处理+组策略 实现规定时间段无法开机and定时关机_2023-01-18



> ```shell
> if "%time:~,1%" equ " " if "%time:~1,1%" leq "5" goto shutdownNow
> # %time:~,1% 获取当前时间，指针从左往右偏移NULL，取1位值
> # EQU - 等于；赋值符
> # %time:~1,1% 获取当前时间，指针从左往右偏移1位，取1位值
> # LEQ - 小于或等于
> goto setShutdown	# 执行函数“setShutdown”
> :shutdownNow	# 创建一个函数“shutdownNow”
> shutdown -s -t 0
> goto end	# 执行函数“end”
> :setShutdown	# 创建一个函数“setShutdown”
> set /a t = (23 - %time:~,2%) * 3600 + (59 - %time:~3,2%) * 60 + (55 - %time:~6,2%)
> # %time:~,2% 获取当前时间，指针从左往右偏移NULL，取2位值
> # %time:~3,2% 获取当前时间，指针从左往右偏移3位，取2位值
> # %time:~6,2% 获取当前时间，指针从左往右偏移6位，取2位值
> shutdown -s -t %t%
> # %t% 获取t的值。计算机在t秒后关机
> :end
> ```
>
> 
>
> > 批处理+组策略 实现规定时间段无法开机and定时关机 - 某爱熬夜的人对付自己的东西
> >
> > https://blog.csdn.net/weixin_34019929/article/details/93762943
> >
> > 批处理+组策略 实现规定时间段无法开机and定时关机
> >
> > https://www.cnblogs.com/book-book/p/5650997.html



因为是在开机时运行脚本命令。执行数学运算，以“预定的关机时间” 减去 “运行脚本时获取的系统时间”

如果获取的时间出错，预定的关机可能受影响



由于`leq "5"`表示 判断是否小于等于5，因此，计算机在6:00才被允许开机

第一行语句：`equ " "`如果当前时间在0点~9点，执行`%time:~,1%`命令，会返回结果” 1~ 9“（数字前面包含空格）

空格占一位，数字也占一位，小时的值仍然占两位。

> 有个问题， 就是如果TIME 是00点的时候，电脑显示的是0 不是00所以TIME 0~2 会有空格。
>
> https://blog.csdn.net/weixin_41121249/article/details/123518317



## AD域策略启动关机脚本不执行的注意事项

> 是脚本路径的问题。
>
> **正确的方法：**
>
> 点击下方的显示文件，将脚本复制到自动打开的文件夹中，然后添加该路径下的脚本文件。入上图第一行。
>
> 如果你是在一个新的策略中设置这项，建议你先复制脚本到自动打开的文件夹中，然后再点添加，那么浏览时会自动进入脚本该在的目录。
>
> **注意事项：**
>
> 先添加脚本文件到自动打开的目录去，再把这个路径的脚本作为启动脚本添加进去。
>
> 有效的路径不是 盘符 或 “\\” 开头。
>
> > AD域策略启动关机脚本不执行的注意事项
> >
> > https://www.cnblogs.com/jackadam/p/11311437.html



## 参考

`\* / %` - 算数运算符



> <!--set /a 执行数学计算-->
>
> https://zhidao.baidu.com/question/111737455.html

> <!--EQU - 等于-->
>
> <!--LEQ - 小于或等于-->
>
> <!--NEQ - 不等于-->
>
> https://developer.aliyun.com/article/372296

> 批处理中时间设定与%time:~0,2%，返回小时补零的解决办法
>
> https://blog.csdn.net/weixin_41121249/article/details/123518317

